{"is_source_file": true, "format": "TypeScript", "description": "This is a Source file for a Next.js middleware, handling security headers, CORS, and in-memory rate limiting for API routes.", "external_files": ["next/server", "@/lib/rateLimit"], "external_methods": ["NextResponse", "NextRequest", "userAgent", "buildRateLimitHeaders", "consume", "getClientIp"], "published": ["middleware", "config"], "classes": [], "methods": [{"name": "function shouldRateLimit(pathname: string): boolean { shouldRateLimit", "description": "Determines if the given path should be subject to rate limiting based on its prefix.", "scope": "", "scopeKind": ""}, {"name": "function applySecurityHeaders(response: NextResponse, req: NextRequest): NextResponse { applySecurityHeaders", "description": "Adds security-related headers to the response object and handles CORS for API routes.", "scope": "", "scopeKind": ""}, {"name": "export function middleware(req: NextRequest) { middleware", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["shouldRateLimit", "applySecurityHeaders", "getClientIp", "consume", "buildRateLimitHeaders", "NextResponse.json", "NextResponse.next"], "search-terms": ["Next.js middleware", "rate limiting", "security headers", "CORS", "Edge middleware", "API route protection"], "state": 2, "file_id": 61, "knowledge_revision": 164, "git_revision": "a874ee6a0daa4c7848c14b3645e480508642a9b8", "revision_history": [{"129": ""}, {"164": "a874ee6a0daa4c7848c14b3645e480508642a9b8"}], "ctags": [{"_type": "tag", "name": "API_LIMIT", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^const API_LIMIT = 60; \\/\\/ 60 requests per minute per IP+path$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "API_WINDOW_MS", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^const API_WINDOW_MS = 60_000; \\/\\/ 1 minute$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "_000", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^const API_WINDOW_MS = 60_000; \\/\\/ 1 minute$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "applySecurityHeaders", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^function applySecurityHeaders(response: NextResponse, req: NextRequest): NextResponse {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^export const config = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "csp", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^  const csp = [$/", "language": "TypeScript", "kind": "constant", "scope": "applySecurityHeaders", "scopeKind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const headers = new Headers(buildRateLimitHeaders(result));$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "ip", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const ip = getClientIp(req.headers);$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const key = `${ip}:${pathname}`;$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "middleware", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^export function middleware(req: NextRequest) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "origin", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^  const origin = req.headers.get(\"origin\") || \"\";$/", "language": "TypeScript", "kind": "constant", "scope": "applySecurityHeaders", "scopeKind": "function"}, {"_type": "tag", "name": "pathname", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^  const { pathname } = req.nextUrl;$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "preflight", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const preflight = NextResponse.json({}, { status: 204 });$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^      const res = NextResponse.json($/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const res = NextResponse.next({ headers });$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^  const res = NextResponse.next();$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^    const result = consume(key, {$/", "language": "TypeScript", "kind": "constant", "scope": "middleware", "scopeKind": "function"}, {"_type": "tag", "name": "shouldRateLimit", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/middleware.ts", "pattern": "/^function shouldRateLimit(pathname: string): boolean {$/", "language": "TypeScript", "kind": "function"}], "hash": "4a7266ee68a78be62a5a5f9449cfab1f", "format-version": 4, "code-base-name": "connecto-v1", "filename": "src/middleware.ts"}