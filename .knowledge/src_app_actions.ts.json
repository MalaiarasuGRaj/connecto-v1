{"is_source_file": true, "format": "TypeScript", "description": "This source file defines server-side actions and functions for handling user interactions, including reading data files related to companies, interfacing with an external API (OpenRouter), and managing user conversation flow for a chatbot application.", "external_files": ["fs", "path", "@/lib/config", "zod"], "external_methods": ["fs.promises.readdir", "fs.promises.readFile", "path.join", "path.extname", "path.dirname", "fetch"], "published": ["getResponse", "generateChatResponse"], "classes": [], "methods": [{"name": "async function getCompanyFilenames(): Promise<string[]> { getCompanyFilenames", "description": "Asynchronously reads the 'data' directory to list all '.txt' files, representing company data files.", "scope": "", "scopeKind": ""}, {"name": "async function getCompanyData(filename: string): Promise<string> { getCompanyData", "description": "Reads and returns the contents of a specified company data file, with a security check to prevent path traversal.", "scope": "", "scopeKind": ""}, {"name": "async function callOpenRouter(systemPrompt: string, userMessage: string, history: {role: string,/ callOpenRouter", "description": "Sends a chat completion request to the OpenRouter API with a specified prompt, message, and conversation history.", "scope": "", "scopeKind": ""}, {"name": "export async function getResponse(input: { message: string, history: any[] }) { getResponse", "description": "Main processing function that determines relevant data files based on user input, queries the data, and generates an appropriate response.", "scope": "", "scopeKind": ""}, {"name": "export async function generateChatResponse(input: { generateChatResponse", "description": "Public wrapper around getResponse, normalizing roles and serving as the API entry point for chat responses.", "scope": "", "scopeKind": ""}], "calls": ["fs.promises.readdir", "fs.promises.readFile", "path.join", "path.extname", "path.dirname", "fetch", "callOpenRouter"], "search-terms": ["actions.ts", "getCompanyFilenames", "callOpenRouter", "company data", "chatbot", "OpenRouter API", "file reading", "conversation management"], "state": 2, "file_id": 41, "knowledge_revision": 139, "git_revision": "75158debfc5dd420aa6575873052d9de88461016", "revision_history": [{"101": "205c715cf568c9bc2ad27e3099767a265ac7db49"}, {"120": "edf1371341470e48b22d6de525292a7208cf69d9"}, {"122": "edf1371341470e48b22d6de525292a7208cf69d9"}, {"139": "75158debfc5dd420aa6575873052d9de88461016"}], "ctags": [{"_type": "tag", "name": "MessageSchema", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^const MessageSchema = z.object({$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "OPENROUTER_API_KEY", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const OPENROUTER_API_KEY = config.ai.openrouterApiKey();$/", "language": "TypeScript", "kind": "constant", "scope": "callOpenRouter", "scopeKind": "function"}, {"_type": "tag", "name": "RequestSchema", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^const RequestSchema = z.object({$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "answerGenerationPrompt", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^        const answerGenerationPrompt = `You are a helpful AI assistant. Your primary goal is to /", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "callOpenRouter", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^async function callOpenRouter(systemPrompt: string, userMessage: string, history: {role: string,/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "companyKnowledge", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^        const companyKnowledge = await getCompanyData(relevantFilename);$/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "dataDir", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const dataDir = path.join(process.cwd(), 'data');$/", "language": "TypeScript", "kind": "constant", "scope": "getCompanyData", "scopeKind": "function"}, {"_type": "tag", "name": "dataDir", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const dataDir = path.join(process.cwd(), 'data');$/", "language": "TypeScript", "kind": "constant", "scope": "getCompanyFilenames", "scopeKind": "function"}, {"_type": "tag", "name": "errorBody", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^        const errorBody = await response.text();$/", "language": "TypeScript", "kind": "constant", "scope": "callOpenRouter", "scopeKind": "function"}, {"_type": "tag", "name": "filePath", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const filePath = path.join(dataDir, filename);$/", "language": "TypeScript", "kind": "constant", "scope": "getCompanyData", "scopeKind": "function"}, {"_type": "tag", "name": "fileSelectionPrompt", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const fileSelectionPrompt = `You are an expert at routing user questions to the correct docu/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "filenames", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const filenames = await getCompanyFilenames();$/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "files", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const files = await fs.promises.readdir(dataDir);$/", "language": "TypeScript", "kind": "constant", "scope": "getCompanyFilenames", "scopeKind": "function"}, {"_type": "tag", "name": "generalPrompt", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const generalPrompt = `You are a helpful and friendly career assistant chatbot for students./", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "generateChatResponse", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^export async function generateChatResponse(input: {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCompanyData", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^async function getCompanyData(filename: string): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getCompanyFilenames", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^async function getCompanyFilenames(): Promise<string[]> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getResponse", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^export async function getResponse(input: { message: string, history: any[] }) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "history", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const history = (input.history ?? []).map(h => ({$/", "language": "TypeScript", "kind": "constant", "scope": "generateChatResponse", "scopeKind": "function"}, {"_type": "tag", "name": "history", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const { message: userMessage, history } = validatedInput.data;$/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "jsonResponse", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const jsonResponse = await response.json();$/", "language": "TypeScript", "kind": "constant", "scope": "callOpenRouter", "scopeKind": "function"}, {"_type": "tag", "name": "mappedHistory", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const mappedHistory = history.map(h => ({$/", "language": "TypeScript", "kind": "constant", "scope": "callOpenRouter", "scopeKind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const { message: userMessage, history } = validatedInput.data;$/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}, {"_type": "tag", "name": "response", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^    const response = await fetch(\"https:\\/\\/openrouter.ai\\/api\\/v1\\/chat\\/completions\", {$/", "language": "TypeScript", "kind": "constant", "scope": "callOpenRouter", "scopeKind": "function"}, {"_type": "tag", "name": "validatedInput", "path": "/home/kavia/workspace/code-generation/connecto-v1/src/app/actions.ts", "pattern": "/^  const validatedInput = RequestSchema.safeParse(input);$/", "language": "TypeScript", "kind": "constant", "scope": "getResponse", "scopeKind": "function"}], "hash": "7ac1649a1d913933e5bf82bcce27aaf4", "format-version": 4, "code-base-name": "connecto-v1", "filename": "src/app/actions.ts"}